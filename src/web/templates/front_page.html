{% extends "base.html" %}

{% block title %}Front Page{% endblock %}

{% block content %}
<section class="front-page">
    {% set lead_story = stories_by_column.get('politics', [])[0] if stories_by_column.get('politics') else none %}

    {# ── Above the Fold ── #}
    <div class="above-fold">
        {# Lead Story (left column ~60%) #}
        {% if lead_story %}
        <article class="lead-story">
            {% if lead_story.hero_image_url %}
            <figure class="lead-image">
                <a href="/story/{{ lead_story.story_id }}">
                    <img src="{{ lead_story.hero_image_url }}" alt="{{ lead_story.generated_headline }}" loading="lazy">
                </a>
                {% if lead_story.hero_image_source %}
                <figcaption class="photo-credit">{{ lead_story.hero_image_source }}</figcaption>
                {% endif %}
            </figure>
            {% endif %}
            <h2 class="lead-headline">
                <a href="/story/{{ lead_story.story_id }}">{{ lead_story.generated_headline }}</a>
            </h2>
            {% set lead_preview = lead_story.article or lead_story.summary or '' %}
            {% if lead_preview %}
            <p class="lead-summary">{{ lead_preview[:300] }}{% if lead_preview|length > 300 %}...{% endif %}</p>
            {% endif %}
            <div class="lead-meta">
                <span class="source-count">{{ lead_story.source_count }} sources</span>
                <span class="sep">&bull;</span>
                <span class="article-count">{{ lead_story.article_count }} articles</span>
                {% if lead_story.first_pub_date %}
                <span class="sep">&bull;</span>
                <time class="timeago" datetime="{{ lead_story.first_pub_date }}">{{ lead_story.first_pub_date }}</time>
                {% endif %}
                {% if lead_story.bias_coverage %}
                <span class="sep">&bull;</span>
                <span class="bias-indicators">
                    {% for bias in ['left', 'lean-left', 'center', 'lean-right', 'right'] %}
                        {% if bias in lead_story.bias_coverage %}
                        <span class="bias-dot" style="background: {{ bias_colors[bias] }}" title="{{ bias|title }}: {{ lead_story.bias_coverage[bias] }}"></span>
                        {% endif %}
                    {% endfor %}
                </span>
                {% endif %}
            </div>
            <a href="/story/{{ lead_story.story_id }}" class="read-full">Read full coverage &rarr;</a>
        </article>
        {% endif %}

        {# Sidebar - Secondary Stories (right column ~40%) #}
        <aside class="sidebar-stories">
            {% for col_name in ['tech', 'money', 'sports'] %}
                {% set col_stories = stories_by_column.get(col_name, []) %}
                {% if col_stories %}
                {% set story = col_stories[0] %}
                <article class="sidebar-story">
                    {% if story.hero_image_url and not loop.last %}
                    <a href="/story/{{ story.story_id }}" class="sidebar-image">
                        <img src="{{ story.hero_image_url }}" alt="{{ story.generated_headline }}" loading="lazy">
                    </a>
                    {% endif %}
                    <div class="sidebar-content">
                        <span class="column-label">{{ col_name|title }}</span>
                        <h3 class="sidebar-headline">
                            <a href="/story/{{ story.story_id }}">{{ story.generated_headline }}</a>
                        </h3>
                        <div class="story-meta">
                            <span>{{ story.source_count }} sources</span>
                            {% if story.bias_coverage %}
                            <span class="bias-indicators">
                                {% for bias in ['left', 'lean-left', 'center', 'lean-right', 'right'] %}
                                    {% if bias in story.bias_coverage %}
                                    <span class="bias-dot" style="background: {{ bias_colors[bias] }}"></span>
                                    {% endif %}
                                {% endfor %}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </article>
                {% if not loop.last %}<hr class="sidebar-divider">{% endif %}
                {% endif %}
            {% endfor %}
        </aside>
    </div>

    {# ── Below the Fold - Section Blocks ── #}
    <hr class="fold-rule">
    <div class="section-grid">
        {% for col in columns %}
        <section class="section-block">
            <h3 class="section-header">
                <a href="/column/{{ col }}">{{ col|title }}</a>
            </h3>

            {% if col == 'politics' %}
                {% set section_stories = stories_by_column.get(col, [])[1:] %}
            {% elif col in ['tech', 'money', 'sports'] %}
                {% set section_stories = stories_by_column.get(col, [])[1:] %}
            {% else %}
                {% set section_stories = stories_by_column.get(col, []) %}
            {% endif %}

            {% if section_stories and section_stories[0].hero_image_url %}
            <a href="/story/{{ section_stories[0].story_id }}" class="section-thumb">
                <img src="{{ section_stories[0].hero_image_url }}" alt="" loading="lazy">
            </a>
            {% endif %}

            <ul class="section-headlines">
                {% for story in section_stories[:3] %}
                <li>
                    <a href="/story/{{ story.story_id }}">{{ story.generated_headline }}</a>
                    <span class="story-meta"><span>{{ story.source_count }} sources</span></span>
                </li>
                {% endfor %}
            </ul>

            <a href="/column/{{ col }}" class="section-more">More {{ col }} &rarr;</a>
        </section>
        {% endfor %}
    </div>
</section>
{% endblock %}
